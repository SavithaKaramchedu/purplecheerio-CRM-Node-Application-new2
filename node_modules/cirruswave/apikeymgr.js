var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(e){var m=function(){};m.prototype=e;return new m};$jscomp.underscoreProtoCanBeSet=function(){var e={a:!0},m={};try{return m.__proto__=e,m.a}catch(p){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(e,m){e.__proto__=m;if(e.__proto__!==m)throw new TypeError(e+" is not extensible");return e}:null;
$jscomp.inherits=function(e,m){e.prototype=$jscomp.objectCreate(m.prototype);e.prototype.constructor=e;if($jscomp.setPrototypeOf){var p=$jscomp.setPrototypeOf;p(e,m)}else for(p in m)if("prototype"!=p)if(Object.defineProperties){var k=Object.getOwnPropertyDescriptor(m,p);k&&Object.defineProperty(e,p,k)}else e[p]=m[p];e.superClass_=m.prototype};$jscomp.owns=function(e,m){return Object.prototype.hasOwnProperty.call(e,m)};
$jscomp.assign="function"==typeof Object.assign?Object.assign:function(e,m){for(var p=1;p<arguments.length;p++){var k=arguments[p];if(k)for(var q in k)$jscomp.owns(k,q)&&(e[q]=k[q])}return e};$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,m,p){e!=Array.prototype&&e!=Object.prototype&&(e[m]=p.value)};$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e};
$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(e,m,p,k){if(m){p=$jscomp.global;e=e.split(".");for(k=0;k<e.length-1;k++){var q=e[k];q in p||(p[q]={});p=p[q]}e=e[e.length-1];k=p[e];m=m(k);m!=k&&null!=m&&$jscomp.defineProperty(p,e,{configurable:!0,writable:!0,value:m})}};$jscomp.polyfill("Object.assign",function(e){return e||$jscomp.assign},"es6","es3");
(function(){function e(e,c){q[e]||(k[e]={exports:{},loaded:!1},q[e]=!0,0===e&&"function"===typeof require?require.main=k[0]:k[e].parent=k[c],p[e].call(this,k[e],k[e].exports),k[e].loaded=!0);return k[e].exports}function m(e){return require("path").resolve(__dirname+"/"+e+"/../")}var p={},k={},q={};p[0]=function(p,c){function t(a,b){return{status:a,message:b}}function k(a,b){d.storage.Get(a,d.folderkeys,function(d,g){d?b(t(404,"acckey="+a+" "+d),null):b(null,g)})}function H(a,b){k(a,function(a,d){a?
b(a,null):(a=JSON.parse(JSON.stringify(d)),delete a.secret,b(null,a))})}function x(a,b){d.storage.Get(a,d.folderids,function(d,g){d?b(t(404,"client="+a+" "+d),null):b(null,g)})}function l(a,b,f){d.storage.Put(a,b,d.folderids,function(g,r){g?f(t(404,g),null):"file"===d.type?f(null,r):d.storage.Put(b.acckey,b,d.folderkeys,function(b,d){b&&B(a,!1,function(a,d){a?d(t(404,a),null):d(t(404,b),null)});f(null,d)})})}function n(a,b,d,f,h){x(a,function(g,r){var w={services:[]};g||(w=r);w.acckey=b;w.secret=
d;w.clientid=a;for(var c in f)0>w.services.indexOf(f[c])&&w.services.push(f[c]);l(a,w,h)})}function B(a,b,f){x(a,function(g,r){d.storage.Delete(a,d.folderids,function(a,g){a?f(a,null):"file"!==d.type&&b?d.storage.Delete(r.acckey,d.folderkeys,function(a,b){a?f(a,null):f(null,"OK")}):f(null,"OK")})})}function v(a,b){if(a=a.authorization)if(0!=a.search(/basic /i))b(t(403,"basic authorization header needs to start with basic"),null);else{a=a.slice(6);var d=Buffer.from(a,"base64").toString().split(":"),
g=d[0];k(g,function(a,f){a?b(t(403,"acckey="+g+" not found"),null):d[1]===f.secret?b(null,f):b(t(403,"could not authenticate"),null)})}else b(t("403","Authorization header missing"),null)}function u(a,b){var d=a.authorization;if(d)if(0!=d.search(/hmac /i))v(a,b);else{var g=d.slice(5).split(":"),f=g[0];k(f,function(d,r){if(d)b(t(403,"acckey="+f+" not found"),null);else{var h=a.date,w=g.splice(-1,1)[0];d=g.join(":");C(r.secret,d+(":"+h))==w?b(null,r):b(t(403,"could not authenticate"),null)}})}else b(t(403,
"Authorization header missing"),null)}function q(a,b,d){var g=(new Date).valueOf(),f=Math.round(Math.random()*g),r=y.GenerateKeyFromDate(f.toString());f=Math.round(Math.random()*g);g=y.GenerateKeyFromDate(f.toString());n(a,r,g,b,d)}function A(a){var b=y.GetServiceConfig(z,a);return b?b:b=y.GetServiceConfig(D,a)}function F(a,b,d){k(a,function(a,g){a?d(a,null):(a=A(b))?"accesskey"!==a.security&&"basic"!==a.security?d(t(403,"access is forbidden to service="+b),null):(b&&0>g.services.indexOf(b)&&g.services.push(b),
l(g.clientid,g,d)):d(t(404,"No such service="+b),null)})}function G(a,b,d){k(a,function(a,g){a=A(b);"accesskey"!==a.security&&"basic"!==a.security?d(t(403,"access is forbidden"),null):(a=g.services.indexOf(b),0>a?d(t(403,"no access to service="+b),null):(g.services.splice(a,1),l(g.clientid,g,d)))})}function C(a,b){a=E.createHmac("sha256",a);a.update(b);return a.digest("hex")}var y=e(1,0),E=require("crypto"),z=m("apikeymgr.js")+"/deploy/lib/serviceconfig.json",D=z,a=m("apikeymgr.js");require("fs");
var b=require("path"),d=null,f=e(2,0),h=e(3,0);c.initialize=function(g){var r="./deploy/lib/aclconfig.json";if(g)switch(a=g.appdir,r=g.aclconfig,D=b.resolve(a,g.appserviceconfig),d={type:"file"},g.persistence&&(d=g.persistence),d.folderkeys="pc-keyfolder/keys",d.folderids="pc-keyfolder/ids",d.type){case "file":d.storage=new h(g);break;case "s3":d.storage=new f({encseckey:g.secret,bucketName:d.bucketname,acckey:d.acckey,secretkey:d.secret,region:d.region})}g.aclconfpath=b.resolve(a,r)};c.Sign=function(a,
b){return C(a,b)};c.RouteAllocateAccessKeys=function(a,b){q(a.params.clientid,[],function(a,d){a?b.status(a.status).json(a.message):b.status(200).json(d)})};c.RouteGetClientFromClientid=function(a,b){x(a.params.clientid,function(a,d){a?b.status(a.status).json(a.message):b.status(200).json(d)})};c.RouteGetClientFromAcckey=function(a,b){k(a.params.acckey,function(a,d){a?b.status(a.status).json(a.message):b.status(200).json(d)})};c.RouteRevokeClient=function(a,b){B(a.params.clientid,!0,function(a,d){a?
b.status(a.status).json(a.message):b.status(200).json({data:"OK"})})};c.RouteGrantAccess=function(a,b){F(a.params.acckey,a.params.servicename,function(a,d){a?b.status(a.status).json(a.message):b.status(200).json(d)})};c.RouteRevokeAccess=function(a,b){G(a.params.acckey,a.params.servicename,function(a,d){a?b.status(a.status).json(a.message):b.status(200).json(d)})};c.RouteGetAccessServices=function(a,b){H(a.params.acckey,function(a,d){a?b.status(a.status).json(a.message):b.status(200).json(d.services)})};
c.RouteGetAccessOneService=function(a,b){H(a.params.acckey,function(d,f){d?b.status(d.status).json(d.message):0>f.services.indexOf(a.params.servicename)?b.status(404).json("access was never granted to client="+f.clientid+" for service="+servicename):b.status(200).json(a.params.servicename)})};c.RouteCheckAccessOneService=function(a,b){a.body.headers?u(a.body.headers,function(d,f){d?b.status(d.status).json(d.message):0>f.services.indexOf(a.body.servicename)?b.status(404).json("access was never granted to client="+
o.clientid+" for service="+servicename):b.status(200).json({servicename:a.body.servicename})}):b.status(400).json("headers missing in the body of request")};return p.exports};p[1]=function(p,c){function t(a,b){a=u.createHmac("sha256",a);a.update(b);return a.digest("hex")}function k(a,b){var d=e(0,1);if(a.secret&&a.acckey){if("accesskey"===a.security){var f=new Date,h=a.acckey+":"+a.nonce;b.Authorization="hmac "+h+":"+d.Sign(a.secret,h+":"+f);b.Date=f;return}if("basic"===a.security){d=Buffer.from(a.acckey+
":"+a.secret).toString("base64");b.Authorization="basic "+d;return}}a.Authorization?(b.Authorization=a.Authorization,d=b.Authorization.indexOf("hmac "),0!=d?(d=b.Authorization.search(/basic /i),0!==d&&console.log("badly formed authorization string - needs to start with hmac")):(d=b.Authorization.slice(d+5),d.split(":"),b.Date=a.Date)):console.log("missing authorization string")}function q(a){if(!a)return null;var b="",d;for(d in a)"object"===typeof a[d]?(""!=b&&(b+="&"),b+=d+"="+JSON.stringify(a[d])):
"array"!==typeof a[d]&&(""!=b&&(b+="&"),b+=d+"="+a[d]);return b}var x=require("http"),l=require("https"),n=require("fs"),B=require("path"),v=require("querystring"),u=require("crypto"),A=require("jsonschema").Validator;c.Cipher=function(a,b){var d=u.randomBytes(16).toString("hex").slice(0,16),f=u.createHash("sha256").update(a).digest("hex");f=f.slice(0,32);b=u.createCipheriv("aes-256-ctr",f,d).update(b).toString("hex");a=t(a,b);return d+":::"+b+":::"+a};c.Decipher=function(a,b){var d=b.split(":::");
b=d[0];var f=d[2],h=t(a,d[1]);if(f!=h)return null;d=new Buffer(d[1],"hex");a=u.createHash("sha256").update(a).digest("hex");a=a.slice(0,32);return u.createDecipheriv("aes-256-ctr",a,b).update(d)};c.ValidateSchemaErrorObject=function(a,b){a=(new A).validate(a,b);if(a.errors.length){b="";for(var d in a.errors)b+=a.errors[d].stack+" ";return b}return null};c.ValidateSchema=function(a,b,d,f){return(a=this.ValidateSchemaErrorObject(a,b))?(f.status(422).json({errors:a}),!1):!0};c.BodyValidate=function(a,
b,d,f){return d&&d.bodyschema?(f&&(d.bodyschema.definitions=d.bodyschema.definitions?Object.assign(d.bodyschema.definitions,f):f),this.ValidateSchema(a.body,d.bodyschema,a,b)):!0};c.ParamValidate=function(a,b,d,f){if(d&&d.paramschema){var h=a.params[0],g=d.route;"/"==g.slice(0,1)&&(g=g.slice(1));"/"==h.slice(0,1)&&(h=h.slice(1));"/"==g.slice(-1)&&(g=g.slice(0,-1));"/"==h.slice(-1)&&(h=h.slice(0,-1));for(var c={};""!=g;){var l=!1;":"==g.slice(0,1)&&(l=!0,g=g.slice(1));var e=g.search("/"),n=h.search("/");
if(0<=e){var v=g.slice(0,e);g=g.slice(e+1);var u=h.slice(0,n);h=h.slice(n+1)}else v=g.slice(0),g="",u=h.slice(0),h="";l&&(l=Number(u),isNaN(l)?c[v]=u:c[v]=l)}f&&(d.paramschema.definitions=d.paramschema.definitions?Object.assign(d.paramschema.definitions,f):f);f=a.query;for(e in f)isNaN(f[e])||(f[e]=Number(f[e]));c=Object.assign({},c,f);return this.ValidateSchema(c,d.paramschema,a,b)}return!0};c.deep_value=function(a,b){b=b.split(".");for(var d in b)a=a[b[d]];return a};var I=require("os");c.GetIPFromService=
function(a){var b=I.networkInterfaces(),d=null;a.networkname&&(d=a.networkname);a=null;for(var f in b){for(var h in b[f]){var g=b[f][h];"IPv4"!==g.family||g.internal||(a=g.address)}if(f==d)break}return a};c.getFunctionsOfObject=function(a){return Object.getOwnPropertyNames(a).filter(function(b){return"function"==typeof a[b]})};c.MakeDir=function(a){var b=require("child_process").exec;b("mkdir  "+a)};c.WriteFile=function(a,b){try{return n.writeFileSync(a,b,"utf8"),!0}catch(d){return!1}};c.FormatYYYYMMDD=
function(a){return a.getUTCFullYear()+"-"+("0"+(a.getUTCMonth()+1)).slice(-2)+"-"+("0"+a.getUTCDate()).slice(-2)};c.FormatYYYYMMDDHHMMSS=function(a){return this.FormatYYYYMMDD(a)+"-"+("0"+a.getUTCHours()).slice(-2)+"-"+("0"+a.getUTCMinutes()).slice(-2)+"-"+("0"+a.getUTCSeconds()).slice(-2)};c.FormatYYYYMMDDHHMMSSColon=function(a){return this.FormatYYYYMMDD(a)+"T"+("0"+a.getUTCHours()).slice(-2)+":"+("0"+a.getUTCMinutes()).slice(-2)+":"+("0"+a.getUTCSeconds()).slice(-2)};c.Median=function(a){a.sort(function(a,
b){return a-b});var b=a.length,d=Math.floor(b/2),f;1===b%2?f=a[d]:f=(a[d-1]+a[d])/2;return f};c.LowPassFilter=function(a,b,d){if(.1<Math.abs(b)){var f=(b-a)/a;f>d?b=a*(1+d):f<d&&(b=a*(1-d))}return b};c.PostPutHttp=function(a,b,d,f,h,g,c,e,n,v){var r={"User-Agent":"app-bt/0.0.1","Content-Type":"application/json","Cache-Control":"no-cache","Content-Length":e.length};d&&(r[d.keyName]=d.keyValue);if(b&&"object"===typeof b){if("accesskey"===b.security||"basic"===b.security)k(b,r),b=null;b=null}a={hostname:h,
port:c,path:g,method:a,headers:r,json:!0};b&&(a.auth=b);b=x;if("https"==f||"https:"==f)a.rejectUnauthorized=!1,b=l;f=b.request(a,function(a){var b="";a.setEncoding("utf8");a.on("data",function(a){b+=a});a.on("end",function(){200!=a.statusCode&&(console.log("Error statusCode="+a.statusCode),b&&console.log("data="+JSON.stringify(b)));n&&n(v,a.statusCode,b)})});f.on("error",function(a){console.log("problem with request: "+a.message);n&&n(v,500,a)});f.write(e);f.end()};c.PostHttpAuth=function(a,b,d,f,
h,g,c,e,l){this.PostPutHttp("POST",a,b,d,f,h,g,c,e,l)};c.PostHttp=function(a,b,d,f,h,g,c,e){this.PostPutHttp("POST",null,a,b,d,f,h,g,c,e)};c.PutHttp=function(a,b,d,f,h,g,c,e){this.PostPutHttp("PUT",null,a,b,d,f,h,g,c,e)};c.GetHttpAuth=function(a,b,d,f,h){a=x.request({hostname:a,port:d,path:b+"/"+f,method:"GET",headers:{"User-Agent":"app-bt/0.0.1","Content-Type":"application/json","Cache-Control":"no-cache","Content-Length":f.length},json:!0},function(a){var b="";a.setEncoding("utf8");a.on("data",
function(a){b+=a});a.on("end",function(){200!=a.statusCode&&console.log("Error statusCode="+a.statusCode);h(a.statusCode,b)})});a.on("error",function(a){console.log("problem with request: "+a.message)});a.end()};c.GetDeleteHttp=function(a,b,d,f,h,g,c,e,n,u){var r={"User-Agent":"app-bt/0.0.1","Cache-Control":"no-cache"};d&&(r[d.keyName]=d.keyValue);if(b&&"object"===typeof b){if("accesskey"===b.security||"basic"===b.security)k(b,r),b=null;b=null}e&&(e=v.escape(e),g=g+"/?"+e);a={hostname:h,port:c,path:g,
method:a,headers:r,json:!0};b&&(a.auth=b);b=x;if("https"==f||"https:"==f)a.rejectUnauthorized=!1,b=l;f=b.request(a,function(a){var b="";a.setEncoding("utf8");a.on("data",function(a){b+=a});a.on("end",function(){200!=a.statusCode&&console.log("Error statusCode="+a.statusCode);n(u,a.statusCode,b)})});f.on("error",function(a){console.log("problem with request: "+a.message)});f.end()};c.GetHttpProper=function(a,b,d,f,h,g,c,e,l){this.GetDeleteHttp("GET",a,b,d,f,h,g,c,e,l)};c.DeleteHttp=function(a,b,d,
f,h,g,c,e,l){this.GetDeleteHttp("DELETE",a,b,d,f,h,g,c,e,l)};var F=0,G=require("url");try{var C=B.resolve(m("cirruswaveutil.js"),"./lib/deploy.json"),y=n.readFileSync(C,"UTF8"),E=JSON.parse(y)}catch(a){"ENOENT"!=a.code&&console.log(a.code+" - "+a.message)}c.RestTaskCall=function(a,b,d){var f=!1,h={};a.payload&&console.log("\t\tpayload ="+JSON.stringify(a.payload));var g=null;if(a.service&&a.servicepath){if(a.sysservice){if(!a.serviceconfig){h="Parameter error: Task="+a.name+" does not contain serviceconfig";
console.error(h);b(d,404,JSON.stringify(h));return}var c=this.GetServiceConfig(a.serviceconfig,a.service)}else{if(!a.appserviceconfig){h="Parameter error: Task="+a.name+" does not contain appserviceconfig";console.error(h);b(d,404,JSON.stringify(h));return}c=this.GetServiceConfig(a.appserviceconfig,a.service);if(!c){if(!a.serviceconfig){h="Parameter error: Task="+a.name+" does not contain serviceconfig";console.error(h);b(d,404,JSON.stringify(h));return}c=this.GetServiceConfig(a.serviceconfig,a.service)}}if(!(c&&
"object"==typeof c&&c.hasOwnProperty("protocol")&&c.hasOwnProperty("hostname")&&c.hasOwnProperty("port"))){h="Parameter error: Task="+a.name+" has unrecognized service="+a.service+" sc="+JSON.stringify(c);console.error(h);b(d,404,JSON.stringify(h));return}E&&E.dnsservicename&&"localhost"==c.hostname&&(c.hostname=a.service);f=!0;h.protocol=c.protocol;h.hostname=c.hostname;h.port=c.port;switch(c.security){case "basic":case "accesskey":g={};g.security=c.security;g.nonce=F++;g.acckey=a.acckey;g.secret=
a.secretna;break;case "appkey":h.key=a.appkey?this.MakeKeyServiceAndKeyValue(a.service,a.appkey):this.MakeKeyServiceAndKeyValue(a.service,c.key)}h.pathname=a.servicepath;0!=h.pathname.search("/")&&(h.pathname="/"+h.pathname)}if(a.url||f)switch(f=null,a.payload&&(f=a.payload),a.url&&(h=G.parse(a.url),h.key=null),a.method){case "POST":a="";f&&(a=JSON.stringify(f));this.PostPutHttp("POST",g,h.key,h.protocol,h.hostname,h.pathname,h.port,a,b,d);break;case "PUT":a="";f&&(a=JSON.stringify(f));this.PostPutHttp("PUT",
g,h.key,h.protocol,h.hostname,h.pathname,h.port,a,b,d);break;case "GET":a="";f&&(a=q(f));this.GetHttpProper(g,h.key,h.protocol,h.hostname,h.pathname,h.port,a,b,d);break;case "DELETE":a="";f&&(a=q(f));this.DeleteHttp(g,h.key,h.protocol,h.hostname,h.pathname,h.port,a,b,d);break;default:h=a.hasOwnProperty("name")?"Parameter error: Task="+a.name+" has unrecognized method="+a.method:"Parameter error: unrecognized method="+a.method,console.error(h),b(d,404,{error:h})}else a.func?(a.payload&&JSON.parse(JSON.stringify(a.payload)),
h=eval("this.to."+a.func+"(payload)"),b(d,200,h)):b(d,200,{})};c.ServiceKeyName=function(a){return a+"-api-key"};c.MakeKeyServiceAndKeyValue=function(a,b){if(!b)return null;var d={};d.keyName=this.ServiceKeyName(a);d.keyValue=b;return d};c.EstablishKey=function(a,b){var d=n.readFileSync(a,"utf8");d=JSON.parse(d);var f=d.services;if(!f||!f[b]||"appkey"!==f[b].security)return null;f[b].key||(f[b].key=this.GenerateKeyFromDate((new Date).toString()),n.writeFileSync(a,JSON.stringify(d,0,2),"UTF8"));return f[b].key};
c.GenerateKeyFromDate=function(a){return u.createHash("md5").update(a).digest("hex")};c.GetServiceConfig=function(a,b){var d=n.readFileSync(a,"utf8");d=JSON.parse(d);if(!d)return null;var f=d.services;if(!f||!f[b])return null;d=f[b];f[b].security||(f[b].security="nokey",n.writeFileSync(a,JSON.stringify(d,0,2),"UTF8"));return f[b]};c.PriorityQueue=function(a){this._comparator=a||this.DEFAULT_COMPARATOR;this._elements=[];this.DEFAULT_COMPARATOR=function(a,d){if("number"===typeof a&&"number"===typeof d)return a-
d;a=a.toString();d=d.toString();return a==d?0:a>d?1:-1};c.PriorityQueue.isEmpty=function(){return 0===this.size()};this.peek=function(){if(this.isEmpty())throw Error("PriorityQueue is empty");return this._elements[0]};this.deq=function(){return this._elements.length?this._elements.shift():null};this.enq=function(a){a=this._elements.push(a);for(var b=a-1;0<b;){var f=b-1;if(0>=this._compare(b,f))break;this._swap(f,b);b=f}return a};this.size=function(){return this._elements.length};this.getElement=function(a){return 0>
a||a>=this.size()?null:this._elements[a]};this.getElements=function(a){return this._elements};this.forEach=function(a){return this._elements.forEach(a)};this._compare=function(a,d){return this._comparator(this._elements[a],this._elements[d])};this._swap=function(a,d){var b=this._elements[a];this._elements[a]=this._elements[d];this._elements[d]=b}};var z=require("cacheman");c.TtlCache=function(a,b,d){if(!a)return null;if(b||d){var f={};b&&(f.ttl=b);d&&(f.engine=d);this.cache=new z(a,f)}else this.cache=
new z(a);this.Set=function(a,b,d){this.cache.set(a,b,d)};this.Get=function(a,b){this.cache.get(a,b)}};var D=require("dgram");c.Udp=function(a,b,d,f){this.server=D.createSocket("udp4");a||b?(this.server.bind({address:d,port:f}),this.server.on("listen",a),this.server.on("message",b),this.broadcastMode=!1):this.broadcastMode=!0;this.address=function(){return this.server.address().address};this.port=function(){return this.server.address().port};this.broadcast=function(a,b,d){if(this.broadcastMode){var f=
new Buffer(JSON.stringify(d));this.server.send(f,0,f.length,b,a,function(){console.log("Sent '"+f+"'")})}}};return p.exports};p[2]=function(k,c){var p=e(1,2),m=require("aws-sdk"),q=e(4,2);c=function(c){var e=q.call(this)||this;e.bucketName=c.bucketName;e.encseckey=c.encseckey;m.config.region=c.region;m.config.update({accessKeyId:c.acckey,secretAccessKey:c.secretkey});return e};$jscomp.inherits(c,q);c.prototype.Delete=function(c,e,n){(new m.S3({params:{Bucket:this.bucketName+"/"+e}})).deleteObject({Key:c},
function(e,l){if(e)return console.log("Error in posting Content ["+e+"]"),!1;console.log("Successfully Deleted Key = "+c);n&&n(null,"OK")}).on("httpUploadProgress",function(c){console.log(Math.round(c.loaded/c.total*100)+"% done")})};c.prototype.Get=function(c,e,n){var l=this;(new m.S3({params:{Bucket:this.bucketName+"/"+e}})).getObject({Key:c},function(c,e){if(c)return c="Error in getting Content ["+c+"]",console.log(c),n&&n(c,null),!1;c=e.Body.toString();l.encseckey&&(c=p.Decipher(l.encseckey,c),
c=c.toString("UTF8"));console.log("Successfully Get Key = "+c);n&&n(null,JSON.parse(c))}).on("httpUploadProgress",function(c){console.log(Math.round(c.loaded/c.total*100)+"% done")})};c.prototype.ListRecursive=function(c,e,n){var l=new m.S3({params:{Bucket:this.bucketName+"/"+c}});e={Bucket:this.bucketName,MaxKeys:100,ContinuationToken:e};null===c?e.Delimiter="/":e.Prefix="*"!=c?c:"";l.listObjectsV2(e,function(e,l){if(e)return strErr="Error in listing Contents ["+e+"]",console.log(strErr),n&&n(strErr,
null),!1;n&&n(null,l);l.NextContinuationToken&&(console.log("continue="+l.NextContinuationToken),this.ListRecursive(c,l.NextContinuationToken))}).on("httpUploadProgress",function(c){console.log(Math.round(c.loaded/c.total*100)+"% done")})};c.prototype.Listirectories=function(c){this.ListRecursive(null,null,c)};c.prototype.ListObjects=function(c,e){this.ListRecursive(c,null,e)};c.prototype.Put=function(c,e,n,k){n=new m.S3({params:{Bucket:this.bucketName+"/"+n}});var l=JSON.stringify(e);this.encseckey&&
(l=p.Cipher(this.encseckey,l));n.putObject({Key:c,Body:l,ContentType:"text/plain; charset=utf-8"},function(c,l){if(c)return c="Error in posting Content ["+c+"]",console.log(c),k&&k(c,null),!1;console.log("Successfully posted Content");k&&k(null,e)}).on("httpUploadProgress",function(c){console.log(Math.round(c.loaded/c.total*100)+"% done")})};k.exports=c;return k.exports};p[3]=function(k,c){var m=e(1,3),p=e(4,3),q=require("fs"),x=require("path");c=function(c){var e=p.call(this)||this;e.aclpath=c.aclconfpath;
e.encseckey=c.secret;e.appdir=c.appdir;console.log(e.appdir);console.log(c.aclconfig);e.aclpath=x.resolve(e.appdir,c.aclconfig);e.acl=null;q.existsSync(e.aclpath)&&(e.acl=e.ReadAclFromFile(e.aclpath));e.acl||(e.acl={},e.WriteAclToFile(e.aclpath));return e};$jscomp.inherits(c,p);c.prototype.CreateSignature=function(c){return crypto.createHash("sha256").update(c).digest("hex")};c.prototype.WriteAclToFile=function(c){c=JSON.stringify(this.acl);c=m.Cipher(this.encseckey,c);q.writeFileSync(this.aclpath,
c)};c.prototype.ReadAclFromFile=function(c){c=q.readFileSync(this.aclpath,"utf8");c=m.Decipher(this.encseckey,c);if(!c)return null;c=c.toString("UTF8");return JSON.parse(c)};c.prototype.Delete=function(c,e,k){var l=-1;if("pc-keyfolder/keys"===e){for(var n in this.acl)this.acl[n].acckey==c&&(l=n);if(-1===l){k("key "+c+" not found",null);return}}else l=c;delete this.acl[l];k&&k(null,"OK")};c.prototype.Listirectories=function(){};c.prototype.ListObjects=function(c){};c.prototype.Get=function(c,e,k){if("pc-keyfolder/keys"===
e){for(var l in this.acl){var n=this.acl[l];if(n.acckey==c){n.clientid=l;k(null,n);return}}console.log("name="+c+" folder="+e);k("key "+c+" not found",null)}else this.acl[c]?(this.acl[c].clientid=c,k(null,this.acl[c])):(console.log("name="+c+" folder="+e),k("client "+c+" does not exist",null))};c.prototype.Put=function(c,e,k,m){this.acl[c]||(this.acl[c]={services:[]});this.acl[c].acckey=e.acckey;this.acl[c].secret=e.secret;for(var l in e.services)0>this.acl[c].services.indexOf(e.services[l])&&this.acl[c].services.push(e.services[l]);
this.WriteAclToFile(this.aclpath);m(null,this.acl[c])};k.exports=c;return k.exports};p[4]=function(e,c){e.exports=function(){"storagedriver"===this.constructor.name&&(console.error("can not instantiate storage driver"),process.exit(1));var c=[];void 0===this.Get&&c.push("Get");void 0===this.Delete&&c.push("Delete");void 0===this.Listirectories&&c.push("Listirectories");void 0===this.ListObjects&&c.push("ListObjects");void 0===this.Put&&c.push("Put");c.length&&(console.error(c+" required on "+this.constructor.name+
" class"),process.exit(1))};return e.exports};if("object"===typeof module)module.exports=e(0);else return e(0)})();
