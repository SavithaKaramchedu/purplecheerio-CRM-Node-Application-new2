var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var f=function(){};f.prototype=a;return new f};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},f={};try{return f.__proto__=a,f.a}catch(k){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,f){a.__proto__=f;if(a.__proto__!==f)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.inherits=function(a,f){a.prototype=$jscomp.objectCreate(f.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var k=$jscomp.setPrototypeOf;k(a,f)}else for(k in f)if("prototype"!=k)if(Object.defineProperties){var g=Object.getOwnPropertyDescriptor(f,k);g&&Object.defineProperty(a,k,g)}else a[k]=f[k];a.superClass_=f.prototype};$jscomp.owns=function(a,f){return Object.prototype.hasOwnProperty.call(a,f)};
$jscomp.assign="function"==typeof Object.assign?Object.assign:function(a,f){for(var k=1;k<arguments.length;k++){var g=arguments[k];if(g)for(var p in g)$jscomp.owns(g,p)&&(a[p]=g[p])}return a};$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,f,k){a!=Array.prototype&&a!=Object.prototype&&(a[f]=k.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};
$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,f,k,g){if(f){k=$jscomp.global;a=a.split(".");for(g=0;g<a.length-1;g++){var p=a[g];p in k||(k[p]={});k=k[p]}a=a[a.length-1];g=k[a];f=f(g);f!=g&&null!=f&&$jscomp.defineProperty(k,a,{configurable:!0,writable:!0,value:f})}};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");
(function(){function a(a,c){p[a]||(g[a]={exports:{},loaded:!1},p[a]=!0,0===a&&"function"===typeof require?require.main=g[0]:g[a].parent=g[c],k[a].call(this,g[a],g[a].exports),g[a].loaded=!0);return g[a].exports}function f(a){return require("path").resolve(__dirname+"/"+a+"/../")}var k={},g={},p={};k[0]=function(f,c){var w=a(1,0),k=a(2,0),g=require("fs"),u=require("path");c=function(c){var a=k.call(this)||this;a.aclpath=c.aclconfpath;a.encseckey=c.secret;a.appdir=c.appdir;console.log(a.appdir);console.log(c.aclconfig);
a.aclpath=u.resolve(a.appdir,c.aclconfig);a.acl=null;g.existsSync(a.aclpath)&&(a.acl=a.ReadAclFromFile(a.aclpath));a.acl||(a.acl={},a.WriteAclToFile(a.aclpath));return a};$jscomp.inherits(c,k);c.prototype.CreateSignature=function(a){return crypto.createHash("sha256").update(a).digest("hex")};c.prototype.WriteAclToFile=function(a){a=JSON.stringify(this.acl);a=w.Cipher(this.encseckey,a);g.writeFileSync(this.aclpath,a)};c.prototype.ReadAclFromFile=function(a){a=g.readFileSync(this.aclpath,"utf8");a=
w.Decipher(this.encseckey,a);if(!a)return null;a=a.toString("UTF8");return JSON.parse(a)};c.prototype.Delete=function(a,c,f){var q=-1;if("pc-keyfolder/keys"===c){for(var r in this.acl)this.acl[r].acckey==a&&(q=r);if(-1===q){f("key "+a+" not found",null);return}}else q=a;delete this.acl[q];f&&f(null,"OK")};c.prototype.Listirectories=function(){};c.prototype.ListObjects=function(a){};c.prototype.Get=function(a,c,f){if("pc-keyfolder/keys"===c){for(var q in this.acl){var r=this.acl[q];if(r.acckey==a){r.clientid=
q;f(null,r);return}}console.log("name="+a+" folder="+c);f("key "+a+" not found",null)}else this.acl[a]?(this.acl[a].clientid=a,f(null,this.acl[a])):(console.log("name="+a+" folder="+c),f("client "+a+" does not exist",null))};c.prototype.Put=function(a,c,f,w){this.acl[a]||(this.acl[a]={services:[]});this.acl[a].acckey=c.acckey;this.acl[a].secret=c.secret;for(var q in c.services)0>this.acl[a].services.indexOf(c.services[q])&&this.acl[a].services.push(c.services[q]);this.WriteAclToFile(this.aclpath);
w(null,this.acl[a])};f.exports=c;return f.exports};k[1]=function(k,c){function w(b,d){b=v.createHmac("sha256",b);b.update(d);return b.digest("hex")}function g(b,d){var e=a(3,1);if(b.secret&&b.acckey){if("accesskey"===b.security){var x=new Date,m=b.acckey+":"+b.nonce;d.Authorization="hmac "+m+":"+e.Sign(b.secret,m+":"+x);d.Date=x;return}if("basic"===b.security){e=Buffer.from(b.acckey+":"+b.secret).toString("base64");d.Authorization="basic "+e;return}}b.Authorization?(d.Authorization=b.Authorization,
e=d.Authorization.indexOf("hmac "),0!=e?(e=d.Authorization.search(/basic /i),0!==e&&console.log("badly formed authorization string - needs to start with hmac")):(e=d.Authorization.slice(e+5),e.split(":"),d.Date=b.Date)):console.log("missing authorization string")}function p(b){if(!b)return null;var d="",e;for(e in b)"object"===typeof b[e]?(""!=d&&(d+="&"),d+=e+"="+JSON.stringify(b[e])):"array"!==typeof b[e]&&(""!=d&&(d+="&"),d+=e+"="+b[e]);return d}var u=require("http"),q=require("https"),r=require("fs"),
A=require("path"),G=require("querystring"),v=require("crypto"),F=require("jsonschema").Validator;c.Cipher=function(b,d){var e=v.randomBytes(16).toString("hex").slice(0,16),a=v.createHash("sha256").update(b).digest("hex");a=a.slice(0,32);d=v.createCipheriv("aes-256-ctr",a,e).update(d).toString("hex");b=w(b,d);return e+":::"+d+":::"+b};c.Decipher=function(b,d){var e=d.split(":::");d=e[0];var a=e[2],m=w(b,e[1]);if(a!=m)return null;e=new Buffer(e[1],"hex");b=v.createHash("sha256").update(b).digest("hex");
b=b.slice(0,32);return v.createDecipheriv("aes-256-ctr",b,d).update(e)};c.ValidateSchemaErrorObject=function(b,d){b=(new F).validate(b,d);if(b.errors.length){d="";for(var e in b.errors)d+=b.errors[e].stack+" ";return d}return null};c.ValidateSchema=function(b,d,e,a){return(b=this.ValidateSchemaErrorObject(b,d))?(a.status(422).json({errors:b}),!1):!0};c.BodyValidate=function(b,d,e,a){return e&&e.bodyschema?(a&&(e.bodyschema.definitions=e.bodyschema.definitions?Object.assign(e.bodyschema.definitions,
a):a),this.ValidateSchema(b.body,e.bodyschema,b,d)):!0};c.ParamValidate=function(b,d,e,a){if(e&&e.paramschema){var m=b.params[0],h=e.route;"/"==h.slice(0,1)&&(h=h.slice(1));"/"==m.slice(0,1)&&(m=m.slice(1));"/"==h.slice(-1)&&(h=h.slice(0,-1));"/"==m.slice(-1)&&(m=m.slice(0,-1));for(var l={};""!=h;){var n=!1;":"==h.slice(0,1)&&(n=!0,h=h.slice(1));var c=h.search("/"),x=m.search("/");if(0<=c){var f=h.slice(0,c);h=h.slice(c+1);var q=m.slice(0,x);m=m.slice(x+1)}else f=h.slice(0),h="",q=m.slice(0),m="";
n&&(n=Number(q),isNaN(n)?l[f]=q:l[f]=n)}a&&(e.paramschema.definitions=e.paramschema.definitions?Object.assign(e.paramschema.definitions,a):a);a=b.query;for(c in a)isNaN(a[c])||(a[c]=Number(a[c]));l=Object.assign({},l,a);return this.ValidateSchema(l,e.paramschema,b,d)}return!0};c.deep_value=function(b,d){d=d.split(".");for(var e in d)b=b[d[e]];return b};var B=require("os");c.GetIPFromService=function(b){var d=B.networkInterfaces(),e=null;b.networkname&&(e=b.networkname);b=null;for(var a in d){for(var c in d[a]){var h=
d[a][c];"IPv4"!==h.family||h.internal||(b=h.address)}if(a==e)break}return b};c.getFunctionsOfObject=function(b){return Object.getOwnPropertyNames(b).filter(function(d){return"function"==typeof b[d]})};c.MakeDir=function(b){var d=require("child_process").exec;d("mkdir  "+b)};c.WriteFile=function(b,d){try{return r.writeFileSync(b,d,"utf8"),!0}catch(e){return!1}};c.FormatYYYYMMDD=function(b){return b.getUTCFullYear()+"-"+("0"+(b.getUTCMonth()+1)).slice(-2)+"-"+("0"+b.getUTCDate()).slice(-2)};c.FormatYYYYMMDDHHMMSS=
function(b){return this.FormatYYYYMMDD(b)+"-"+("0"+b.getUTCHours()).slice(-2)+"-"+("0"+b.getUTCMinutes()).slice(-2)+"-"+("0"+b.getUTCSeconds()).slice(-2)};c.FormatYYYYMMDDHHMMSSColon=function(b){return this.FormatYYYYMMDD(b)+"T"+("0"+b.getUTCHours()).slice(-2)+":"+("0"+b.getUTCMinutes()).slice(-2)+":"+("0"+b.getUTCSeconds()).slice(-2)};c.Median=function(b){b.sort(function(b,d){return b-d});var d=b.length,e=Math.floor(d/2),a;1===d%2?a=b[e]:a=(b[e-1]+b[e])/2;return a};c.LowPassFilter=function(b,d,e){if(.1<
Math.abs(d)){var a=(d-b)/b;a>e?d=b*(1+e):a<e&&(d=b*(1-e))}return d};c.PostPutHttp=function(b,d,e,a,c,h,l,n,t,f){var m={"User-Agent":"app-bt/0.0.1","Content-Type":"application/json","Cache-Control":"no-cache","Content-Length":n.length};e&&(m[e.keyName]=e.keyValue);if(d&&"object"===typeof d){if("accesskey"===d.security||"basic"===d.security)g(d,m),d=null;d=null}b={hostname:c,port:l,path:h,method:b,headers:m,json:!0};d&&(b.auth=d);d=u;if("https"==a||"https:"==a)b.rejectUnauthorized=!1,d=q;a=d.request(b,
function(b){var d="";b.setEncoding("utf8");b.on("data",function(b){d+=b});b.on("end",function(){200!=b.statusCode&&(console.log("Error statusCode="+b.statusCode),d&&console.log("data="+JSON.stringify(d)));t&&t(f,b.statusCode,d)})});a.on("error",function(b){console.log("problem with request: "+b.message);t&&t(f,500,b)});a.write(n);a.end()};c.PostHttpAuth=function(b,d,a,c,m,h,l,n,t){this.PostPutHttp("POST",b,d,a,c,m,h,l,n,t)};c.PostHttp=function(b,d,a,c,m,h,l,n){this.PostPutHttp("POST",null,b,d,a,c,
m,h,l,n)};c.PutHttp=function(b,d,a,c,m,h,l,n){this.PostPutHttp("PUT",null,b,d,a,c,m,h,l,n)};c.GetHttpAuth=function(b,d,a,c,m){b=u.request({hostname:b,port:a,path:d+"/"+c,method:"GET",headers:{"User-Agent":"app-bt/0.0.1","Content-Type":"application/json","Cache-Control":"no-cache","Content-Length":c.length},json:!0},function(b){var a="";b.setEncoding("utf8");b.on("data",function(b){a+=b});b.on("end",function(){200!=b.statusCode&&console.log("Error statusCode="+b.statusCode);m(b.statusCode,a)})});b.on("error",
function(b){console.log("problem with request: "+b.message)});b.end()};c.GetDeleteHttp=function(b,a,e,c,m,h,l,n,t,f){var d={"User-Agent":"app-bt/0.0.1","Cache-Control":"no-cache"};e&&(d[e.keyName]=e.keyValue);if(a&&"object"===typeof a){if("accesskey"===a.security||"basic"===a.security)g(a,d),a=null;a=null}n&&(n=G.escape(n),h=h+"/?"+n);b={hostname:m,port:l,path:h,method:b,headers:d,json:!0};a&&(b.auth=a);a=u;if("https"==c||"https:"==c)b.rejectUnauthorized=!1,a=q;c=a.request(b,function(b){var a="";
b.setEncoding("utf8");b.on("data",function(b){a+=b});b.on("end",function(){200!=b.statusCode&&console.log("Error statusCode="+b.statusCode);t(f,b.statusCode,a)})});c.on("error",function(b){console.log("problem with request: "+b.message)});c.end()};c.GetHttpProper=function(b,a,e,c,m,h,l,n,t){this.GetDeleteHttp("GET",b,a,e,c,m,h,l,n,t)};c.DeleteHttp=function(b,a,e,c,m,h,l,n,t){this.GetDeleteHttp("DELETE",b,a,e,c,m,h,l,n,t)};var H=0,I=require("url");try{var C=A.resolve(f("cirruswaveutil.js"),"./lib/deploy.json"),
y=r.readFileSync(C,"UTF8"),D=JSON.parse(y)}catch(b){"ENOENT"!=b.code&&console.log(b.code+" - "+b.message)}c.RestTaskCall=function(b,a,e){var d=!1,c={};b.payload&&console.log("\t\tpayload ="+JSON.stringify(b.payload));var h=null;if(b.service&&b.servicepath){if(b.sysservice){if(!b.serviceconfig){c="Parameter error: Task="+b.name+" does not contain serviceconfig";console.error(c);a(e,404,JSON.stringify(c));return}var l=this.GetServiceConfig(b.serviceconfig,b.service)}else{if(!b.appserviceconfig){c="Parameter error: Task="+
b.name+" does not contain appserviceconfig";console.error(c);a(e,404,JSON.stringify(c));return}l=this.GetServiceConfig(b.appserviceconfig,b.service);if(!l){if(!b.serviceconfig){c="Parameter error: Task="+b.name+" does not contain serviceconfig";console.error(c);a(e,404,JSON.stringify(c));return}l=this.GetServiceConfig(b.serviceconfig,b.service)}}if(!(l&&"object"==typeof l&&l.hasOwnProperty("protocol")&&l.hasOwnProperty("hostname")&&l.hasOwnProperty("port"))){c="Parameter error: Task="+b.name+" has unrecognized service="+
b.service+" sc="+JSON.stringify(l);console.error(c);a(e,404,JSON.stringify(c));return}D&&D.dnsservicename&&"localhost"==l.hostname&&(l.hostname=b.service);d=!0;c.protocol=l.protocol;c.hostname=l.hostname;c.port=l.port;switch(l.security){case "basic":case "accesskey":h={};h.security=l.security;h.nonce=H++;h.acckey=b.acckey;h.secret=b.secretna;break;case "appkey":c.key=b.appkey?this.MakeKeyServiceAndKeyValue(b.service,b.appkey):this.MakeKeyServiceAndKeyValue(b.service,l.key)}c.pathname=b.servicepath;
0!=c.pathname.search("/")&&(c.pathname="/"+c.pathname)}if(b.url||d)switch(d=null,b.payload&&(d=b.payload),b.url&&(c=I.parse(b.url),c.key=null),b.method){case "POST":b="";d&&(b=JSON.stringify(d));this.PostPutHttp("POST",h,c.key,c.protocol,c.hostname,c.pathname,c.port,b,a,e);break;case "PUT":b="";d&&(b=JSON.stringify(d));this.PostPutHttp("PUT",h,c.key,c.protocol,c.hostname,c.pathname,c.port,b,a,e);break;case "GET":b="";d&&(b=p(d));this.GetHttpProper(h,c.key,c.protocol,c.hostname,c.pathname,c.port,b,
a,e);break;case "DELETE":b="";d&&(b=p(d));this.DeleteHttp(h,c.key,c.protocol,c.hostname,c.pathname,c.port,b,a,e);break;default:c=b.hasOwnProperty("name")?"Parameter error: Task="+b.name+" has unrecognized method="+b.method:"Parameter error: unrecognized method="+b.method,console.error(c),a(e,404,{error:c})}else b.func?(b.payload&&JSON.parse(JSON.stringify(b.payload)),c=eval("this.to."+b.func+"(payload)"),a(e,200,c)):a(e,200,{})};c.ServiceKeyName=function(b){return b+"-api-key"};c.MakeKeyServiceAndKeyValue=
function(b,a){if(!a)return null;var c={};c.keyName=this.ServiceKeyName(b);c.keyValue=a;return c};c.EstablishKey=function(b,a){var c=r.readFileSync(b,"utf8");c=JSON.parse(c);var d=c.services;if(!d||!d[a]||"appkey"!==d[a].security)return null;d[a].key||(d[a].key=this.GenerateKeyFromDate((new Date).toString()),r.writeFileSync(b,JSON.stringify(c,0,2),"UTF8"));return d[a].key};c.GenerateKeyFromDate=function(b){return v.createHash("md5").update(b).digest("hex")};c.GetServiceConfig=function(b,a){var c=r.readFileSync(b,
"utf8");c=JSON.parse(c);if(!c)return null;var d=c.services;if(!d||!d[a])return null;c=d[a];d[a].security||(d[a].security="nokey",r.writeFileSync(b,JSON.stringify(c,0,2),"UTF8"));return d[a]};c.PriorityQueue=function(b){this._comparator=b||this.DEFAULT_COMPARATOR;this._elements=[];this.DEFAULT_COMPARATOR=function(b,a){if("number"===typeof b&&"number"===typeof a)return b-a;b=b.toString();a=a.toString();return b==a?0:b>a?1:-1};c.PriorityQueue.isEmpty=function(){return 0===this.size()};this.peek=function(){if(this.isEmpty())throw Error("PriorityQueue is empty");
return this._elements[0]};this.deq=function(){return this._elements.length?this._elements.shift():null};this.enq=function(b){b=this._elements.push(b);for(var a=b-1;0<a;){var c=a-1;if(0>=this._compare(a,c))break;this._swap(c,a);a=c}return b};this.size=function(){return this._elements.length};this.getElement=function(b){return 0>b||b>=this.size()?null:this._elements[b]};this.getElements=function(b){return this._elements};this.forEach=function(b){return this._elements.forEach(b)};this._compare=function(b,
a){return this._comparator(this._elements[b],this._elements[a])};this._swap=function(b,a){var c=this._elements[b];this._elements[b]=this._elements[a];this._elements[a]=c}};var z=require("cacheman");c.TtlCache=function(b,a,c){if(!b)return null;if(a||c){var d={};a&&(d.ttl=a);c&&(d.engine=c);this.cache=new z(b,d)}else this.cache=new z(b);this.Set=function(b,a,c){this.cache.set(b,a,c)};this.Get=function(b,a){this.cache.get(b,a)}};var E=require("dgram");c.Udp=function(b,a,c,f){this.server=E.createSocket("udp4");
b||a?(this.server.bind({address:c,port:f}),this.server.on("listen",b),this.server.on("message",a),this.broadcastMode=!1):this.broadcastMode=!0;this.address=function(){return this.server.address().address};this.port=function(){return this.server.address().port};this.broadcast=function(b,a,c){if(this.broadcastMode){var d=new Buffer(JSON.stringify(c));this.server.send(d,0,d.length,a,b,function(){console.log("Sent '"+d+"'")})}}};return k.exports};k[2]=function(a,c){a.exports=function(){"storagedriver"===
this.constructor.name&&(console.error("can not instantiate storage driver"),process.exit(1));var a=[];void 0===this.Get&&a.push("Get");void 0===this.Delete&&a.push("Delete");void 0===this.Listirectories&&a.push("Listirectories");void 0===this.ListObjects&&a.push("ListObjects");void 0===this.Put&&a.push("Put");a.length&&(console.error(a+" required on "+this.constructor.name+" class"),process.exit(1))};return a.exports};k[3]=function(k,c){function g(b,a){return{status:b,message:a}}function p(b,a){e.storage.Get(b,
e.folderkeys,function(c,d){c?a(g(404,"acckey="+b+" "+c),null):a(null,d)})}function J(b,a){p(b,function(b,c){b?a(b,null):(b=JSON.parse(JSON.stringify(c)),delete b.secret,a(null,b))})}function u(b,a){e.storage.Get(b,e.folderids,function(c,d){c?a(g(404,"client="+b+" "+c),null):a(null,d)})}function q(b,a,c){e.storage.Put(b,a,e.folderids,function(d,h){d?c(g(404,d),null):"file"===e.type?c(null,h):e.storage.Put(a.acckey,a,e.folderkeys,function(a,d){a&&A(b,!1,function(b,c){b?c(g(404,b),null):c(g(404,a),null)});
c(null,d)})})}function r(b,a,c,d,e){u(b,function(h,l){var n={services:[]};h||(n=l);n.acckey=a;n.secret=c;n.clientid=b;for(var t in d)0>n.services.indexOf(d[t])&&n.services.push(d[t]);q(b,n,e)})}function A(b,a,c){u(b,function(d,h){e.storage.Delete(b,e.folderids,function(b,d){b?c(b,null):"file"!==e.type&&a?e.storage.Delete(h.acckey,e.folderkeys,function(b,a){b?c(b,null):c(null,"OK")}):c(null,"OK")})})}function G(b,a){if(b=b.authorization)if(0!=b.search(/basic /i))a(g(403,"basic authorization header needs to start with basic"),
null);else{b=b.slice(6);var c=Buffer.from(b,"base64").toString().split(":"),d=c[0];p(d,function(b,e){b?a(g(403,"acckey="+d+" not found"),null):c[1]===e.secret?a(null,e):a(g(403,"could not authenticate"),null)})}else a(g("403","Authorization header missing"),null)}function v(b,a){var c=b.authorization;if(c)if(0!=c.search(/hmac /i))G(b,a);else{var d=c.slice(5).split(":"),e=d[0];p(e,function(c,h){if(c)a(g(403,"acckey="+e+" not found"),null);else{var l=b.date,n=d.splice(-1,1)[0];c=d.join(":");C(h.secret,
c+(":"+l))==n?a(null,h):a(g(403,"could not authenticate"),null)}})}else a(g(403,"Authorization header missing"),null)}function F(b,a,c){var d=(new Date).valueOf(),e=Math.round(Math.random()*d),h=y.GenerateKeyFromDate(e.toString());e=Math.round(Math.random()*d);d=y.GenerateKeyFromDate(e.toString());r(b,h,d,a,c)}function B(b){var a=y.GetServiceConfig(z,b);return a?a:a=y.GetServiceConfig(E,b)}function H(b,a,c){p(b,function(b,d){b?c(b,null):(b=B(a))?"accesskey"!==b.security&&"basic"!==b.security?c(g(403,
"access is forbidden to service="+a),null):(a&&0>d.services.indexOf(a)&&d.services.push(a),q(d.clientid,d,c)):c(g(404,"No such service="+a),null)})}function I(b,a,c){p(b,function(b,d){b=B(a);"accesskey"!==b.security&&"basic"!==b.security?c(g(403,"access is forbidden"),null):(b=d.services.indexOf(a),0>b?c(g(403,"no access to service="+a),null):(d.services.splice(b,1),q(d.clientid,d,c)))})}function C(b,a){b=D.createHmac("sha256",b);b.update(a);return b.digest("hex")}var y=a(1,3),D=require("crypto"),
z=f("apikeymgr.js")+"/deploy/lib/serviceconfig.json",E=z,b=f("apikeymgr.js");require("fs");var d=require("path"),e=null,x=a(4,3),m=a(0,3);c.initialize=function(a){var c="./deploy/lib/aclconfig.json";if(a)switch(b=a.appdir,c=a.aclconfig,E=d.resolve(b,a.appserviceconfig),e={type:"file"},a.persistence&&(e=a.persistence),e.folderkeys="pc-keyfolder/keys",e.folderids="pc-keyfolder/ids",e.type){case "file":e.storage=new m(a);break;case "s3":e.storage=new x({encseckey:a.secret,bucketName:e.bucketname,acckey:e.acckey,
secretkey:e.secret,region:e.region})}a.aclconfpath=d.resolve(b,c)};c.Sign=function(b,a){return C(b,a)};c.RouteAllocateAccessKeys=function(b,a){F(b.params.clientid,[],function(b,c){b?a.status(b.status).json(b.message):a.status(200).json(c)})};c.RouteGetClientFromClientid=function(b,a){u(b.params.clientid,function(b,c){b?a.status(b.status).json(b.message):a.status(200).json(c)})};c.RouteGetClientFromAcckey=function(b,a){p(b.params.acckey,function(b,c){b?a.status(b.status).json(b.message):a.status(200).json(c)})};
c.RouteRevokeClient=function(b,a){A(b.params.clientid,!0,function(b,c){b?a.status(b.status).json(b.message):a.status(200).json({data:"OK"})})};c.RouteGrantAccess=function(b,a){H(b.params.acckey,b.params.servicename,function(b,c){b?a.status(b.status).json(b.message):a.status(200).json(c)})};c.RouteRevokeAccess=function(b,a){I(b.params.acckey,b.params.servicename,function(b,c){b?a.status(b.status).json(b.message):a.status(200).json(c)})};c.RouteGetAccessServices=function(b,a){J(b.params.acckey,function(b,
c){b?a.status(b.status).json(b.message):a.status(200).json(c.services)})};c.RouteGetAccessOneService=function(b,a){J(b.params.acckey,function(c,d){c?a.status(c.status).json(c.message):0>d.services.indexOf(b.params.servicename)?a.status(404).json("access was never granted to client="+d.clientid+" for service="+servicename):a.status(200).json(b.params.servicename)})};c.RouteCheckAccessOneService=function(b,a){b.body.headers?v(b.body.headers,function(c,d){c?a.status(c.status).json(c.message):0>d.services.indexOf(b.body.servicename)?
a.status(404).json("access was never granted to client="+o.clientid+" for service="+servicename):a.status(200).json({servicename:b.body.servicename})}):a.status(400).json("headers missing in the body of request")};return k.exports};k[4]=function(f,c){var g=a(1,4),k=require("aws-sdk"),p=a(2,4);c=function(a){var c=p.call(this)||this;c.bucketName=a.bucketName;c.encseckey=a.encseckey;k.config.region=a.region;k.config.update({accessKeyId:a.acckey,secretAccessKey:a.secretkey});return c};$jscomp.inherits(c,
p);c.prototype.Delete=function(a,c,f){(new k.S3({params:{Bucket:this.bucketName+"/"+c}})).deleteObject({Key:a},function(c,g){if(c)return console.log("Error in posting Content ["+c+"]"),!1;console.log("Successfully Deleted Key = "+a);f&&f(null,"OK")}).on("httpUploadProgress",function(a){console.log(Math.round(a.loaded/a.total*100)+"% done")})};c.prototype.Get=function(a,c,f){var q=this;(new k.S3({params:{Bucket:this.bucketName+"/"+c}})).getObject({Key:a},function(a,c){if(a)return a="Error in getting Content ["+
a+"]",console.log(a),f&&f(a,null),!1;a=c.Body.toString();q.encseckey&&(a=g.Decipher(q.encseckey,a),a=a.toString("UTF8"));console.log("Successfully Get Key = "+a);f&&f(null,JSON.parse(a))}).on("httpUploadProgress",function(a){console.log(Math.round(a.loaded/a.total*100)+"% done")})};c.prototype.ListRecursive=function(a,c,f){var g=new k.S3({params:{Bucket:this.bucketName+"/"+a}});c={Bucket:this.bucketName,MaxKeys:100,ContinuationToken:c};null===a?c.Delimiter="/":c.Prefix="*"!=a?a:"";g.listObjectsV2(c,
function(c,g){if(c)return strErr="Error in listing Contents ["+c+"]",console.log(strErr),f&&f(strErr,null),!1;f&&f(null,g);g.NextContinuationToken&&(console.log("continue="+g.NextContinuationToken),this.ListRecursive(a,g.NextContinuationToken))}).on("httpUploadProgress",function(a){console.log(Math.round(a.loaded/a.total*100)+"% done")})};c.prototype.Listirectories=function(a){this.ListRecursive(null,null,a)};c.prototype.ListObjects=function(a,c){this.ListRecursive(a,null,c)};c.prototype.Put=function(a,
c,f,p){f=new k.S3({params:{Bucket:this.bucketName+"/"+f}});var q=JSON.stringify(c);this.encseckey&&(q=g.Cipher(this.encseckey,q));f.putObject({Key:a,Body:q,ContentType:"text/plain; charset=utf-8"},function(a,f){if(a)return a="Error in posting Content ["+a+"]",console.log(a),p&&p(a,null),!1;console.log("Successfully posted Content");p&&p(null,c)}).on("httpUploadProgress",function(a){console.log(Math.round(a.loaded/a.total*100)+"% done")})};f.exports=c;return f.exports};if("object"===typeof module)module.exports=
a(0);else return a(0)})();
