var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(f){var l=function(){};l.prototype=f;return new l};$jscomp.underscoreProtoCanBeSet=function(){var f={a:!0},l={};try{return l.__proto__=f,l.a}catch(n){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(f,l){f.__proto__=l;if(f.__proto__!==l)throw new TypeError(f+" is not extensible");return f}:null;
$jscomp.inherits=function(f,l){f.prototype=$jscomp.objectCreate(l.prototype);f.prototype.constructor=f;if($jscomp.setPrototypeOf){var n=$jscomp.setPrototypeOf;n(f,l)}else for(n in l)if("prototype"!=n)if(Object.defineProperties){var k=Object.getOwnPropertyDescriptor(l,n);k&&Object.defineProperty(f,n,k)}else f[n]=l[n];f.superClass_=l.prototype};$jscomp.owns=function(f,l){return Object.prototype.hasOwnProperty.call(f,l)};
$jscomp.assign="function"==typeof Object.assign?Object.assign:function(f,l){for(var n=1;n<arguments.length;n++){var k=arguments[n];if(k)for(var t in k)$jscomp.owns(k,t)&&(f[t]=k[t])}return f};$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(f,l,n){f!=Array.prototype&&f!=Object.prototype&&(f[l]=n.value)};$jscomp.getGlobal=function(f){return"undefined"!=typeof window&&window===f?f:"undefined"!=typeof global&&null!=global?global:f};
$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(f,l,n,k){if(l){n=$jscomp.global;f=f.split(".");for(k=0;k<f.length-1;k++){var t=f[k];t in n||(n[t]={});n=n[t]}f=f[f.length-1];k=n[f];l=l(k);l!=k&&null!=l&&$jscomp.defineProperty(n,f,{configurable:!0,writable:!0,value:l})}};$jscomp.polyfill("Object.assign",function(f){return f||$jscomp.assign},"es6","es3");
(function(){function f(f,d){t[f]||(k[f]={exports:{},loaded:!1},t[f]=!0,0===f&&"function"===typeof require?require.main=k[0]:k[f].parent=k[d],n[f].call(this,k[f],k[f].exports),k[f].loaded=!0);return k[f].exports}function l(f){return require("path").resolve(__dirname+"/"+f+"/../")}var n={},k={},t={};n[0]=function(n,d){function u(a,b){a=w.createHmac("sha256",a);a.update(b);return a.digest("hex")}function k(a,b){var c=f(1,0);if(a.secret&&a.acckey){if("accesskey"===a.security){var e=new Date,g=a.acckey+
":"+a.nonce;b.Authorization="hmac "+g+":"+c.Sign(a.secret,g+":"+e);b.Date=e;return}if("basic"===a.security){c=Buffer.from(a.acckey+":"+a.secret).toString("base64");b.Authorization="basic "+c;return}}a.Authorization?(b.Authorization=a.Authorization,c=b.Authorization.indexOf("hmac "),0!=c?(c=b.Authorization.search(/basic /i),0!==c&&console.log("badly formed authorization string - needs to start with hmac")):(c=b.Authorization.slice(c+5),c.split(":"),b.Date=a.Date)):console.log("missing authorization string")}
function I(a){if(!a)return null;var b="",c;for(c in a)"object"===typeof a[c]?(""!=b&&(b+="&"),b+=c+"="+JSON.stringify(a[c])):"array"!==typeof a[c]&&(""!=b&&(b+="&"),b+=c+"="+a[c]);return b}var x=require("http"),p=require("https"),r=require("fs"),A=require("path"),F=require("querystring"),w=require("crypto"),t=require("jsonschema").Validator;d.Cipher=function(a,b){var c=w.randomBytes(16).toString("hex").slice(0,16),e=w.createHash("sha256").update(a).digest("hex");e=e.slice(0,32);b=w.createCipheriv("aes-256-ctr",
e,c).update(b).toString("hex");a=u(a,b);return c+":::"+b+":::"+a};d.Decipher=function(a,b){var c=b.split(":::");b=c[0];var e=c[2],g=u(a,c[1]);if(e!=g)return null;c=new Buffer(c[1],"hex");a=w.createHash("sha256").update(a).digest("hex");a=a.slice(0,32);return w.createDecipheriv("aes-256-ctr",a,b).update(c)};d.ValidateSchemaErrorObject=function(a,b){a=(new t).validate(a,b);if(a.errors.length){b="";for(var c in a.errors)b+=a.errors[c].stack+" ";return b}return null};d.ValidateSchema=function(a,b,c,e){return(a=
this.ValidateSchemaErrorObject(a,b))?(e.status(422).json({errors:a}),!1):!0};d.BodyValidate=function(a,b,c,e){return c&&c.bodyschema?(e&&(c.bodyschema.definitions=c.bodyschema.definitions?Object.assign(c.bodyschema.definitions,e):e),this.ValidateSchema(a.body,c.bodyschema,a,b)):!0};d.ParamValidate=function(a,b,c,e){if(c&&c.paramschema){var g=a.params[0],h=c.route;"/"==h.slice(0,1)&&(h=h.slice(1));"/"==g.slice(0,1)&&(g=g.slice(1));"/"==h.slice(-1)&&(h=h.slice(0,-1));"/"==g.slice(-1)&&(g=g.slice(0,
-1));for(var m={};""!=h;){var q=!1;":"==h.slice(0,1)&&(q=!0,h=h.slice(1));var v=h.search("/"),d=g.search("/");if(0<=v){var p=h.slice(0,v);h=h.slice(v+1);var f=g.slice(0,d);g=g.slice(d+1)}else p=h.slice(0),h="",f=g.slice(0),g="";q&&(q=Number(f),isNaN(q)?m[p]=f:m[p]=q)}e&&(c.paramschema.definitions=c.paramschema.definitions?Object.assign(c.paramschema.definitions,e):e);e=a.query;for(v in e)isNaN(e[v])||(e[v]=Number(e[v]));m=Object.assign({},m,e);return this.ValidateSchema(m,c.paramschema,a,b)}return!0};
d.deep_value=function(a,b){b=b.split(".");for(var c in b)a=a[b[c]];return a};var E=require("os");d.GetIPFromService=function(a){var b=E.networkInterfaces(),c=null;a.networkname&&(c=a.networkname);a=null;for(var e in b){for(var g in b[e]){var h=b[e][g];"IPv4"!==h.family||h.internal||(a=h.address)}if(e==c)break}return a};d.getFunctionsOfObject=function(a){return Object.getOwnPropertyNames(a).filter(function(b){return"function"==typeof a[b]})};d.MakeDir=function(a){var b=require("child_process").exec;
b("mkdir  "+a)};d.WriteFile=function(a,b){try{return r.writeFileSync(a,b,"utf8"),!0}catch(c){return!1}};d.FormatYYYYMMDD=function(a){return a.getUTCFullYear()+"-"+("0"+(a.getUTCMonth()+1)).slice(-2)+"-"+("0"+a.getUTCDate()).slice(-2)};d.FormatYYYYMMDDHHMMSS=function(a){return this.FormatYYYYMMDD(a)+"-"+("0"+a.getUTCHours()).slice(-2)+"-"+("0"+a.getUTCMinutes()).slice(-2)+"-"+("0"+a.getUTCSeconds()).slice(-2)};d.FormatYYYYMMDDHHMMSSColon=function(a){return this.FormatYYYYMMDD(a)+"T"+("0"+a.getUTCHours()).slice(-2)+
":"+("0"+a.getUTCMinutes()).slice(-2)+":"+("0"+a.getUTCSeconds()).slice(-2)};d.Median=function(a){a.sort(function(a,b){return a-b});var b=a.length,c=Math.floor(b/2),e;1===b%2?e=a[c]:e=(a[c-1]+a[c])/2;return e};d.LowPassFilter=function(a,b,c){if(.1<Math.abs(b)){var e=(b-a)/a;e>c?b=a*(1+c):e<c&&(b=a*(1-c))}return b};d.PostPutHttp=function(a,b,c,e,g,h,m,q,v,d){var f={"User-Agent":"app-bt/0.0.1","Content-Type":"application/json","Cache-Control":"no-cache","Content-Length":q.length};c&&(f[c.keyName]=c.keyValue);
if(b&&"object"===typeof b){if("accesskey"===b.security||"basic"===b.security)k(b,f),b=null;b=null}a={hostname:g,port:m,path:h,method:a,headers:f,json:!0};b&&(a.auth=b);b=x;if("https"==e||"https:"==e)a.rejectUnauthorized=!1,b=p;e=b.request(a,function(a){var b="";a.setEncoding("utf8");a.on("data",function(a){b+=a});a.on("end",function(){200!=a.statusCode&&(console.log("Error statusCode="+a.statusCode),b&&console.log("data="+JSON.stringify(b)));v&&v(d,a.statusCode,b)})});e.on("error",function(a){console.log("problem with request: "+
a.message);v&&v(d,500,a)});e.write(q);e.end()};d.PostHttpAuth=function(a,b,c,e,g,h,m,q,d){this.PostPutHttp("POST",a,b,c,e,g,h,m,q,d)};d.PostHttp=function(a,b,c,e,g,h,m,q){this.PostPutHttp("POST",null,a,b,c,e,g,h,m,q)};d.PutHttp=function(a,b,c,e,g,h,m,q){this.PostPutHttp("PUT",null,a,b,c,e,g,h,m,q)};d.GetHttpAuth=function(a,b,c,e,g){a=x.request({hostname:a,port:c,path:b+"/"+e,method:"GET",headers:{"User-Agent":"app-bt/0.0.1","Content-Type":"application/json","Cache-Control":"no-cache","Content-Length":e.length},
json:!0},function(a){var b="";a.setEncoding("utf8");a.on("data",function(a){b+=a});a.on("end",function(){200!=a.statusCode&&console.log("Error statusCode="+a.statusCode);g(a.statusCode,b)})});a.on("error",function(a){console.log("problem with request: "+a.message)});a.end()};d.GetDeleteHttp=function(a,b,c,e,g,h,m,q,d,f){var v={"User-Agent":"app-bt/0.0.1","Cache-Control":"no-cache"};c&&(v[c.keyName]=c.keyValue);if(b&&"object"===typeof b){if("accesskey"===b.security||"basic"===b.security)k(b,v),b=null;
b=null}q&&(q=F.escape(q),h=h+"/?"+q);a={hostname:g,port:m,path:h,method:a,headers:v,json:!0};b&&(a.auth=b);b=x;if("https"==e||"https:"==e)a.rejectUnauthorized=!1,b=p;e=b.request(a,function(a){var b="";a.setEncoding("utf8");a.on("data",function(a){b+=a});a.on("end",function(){200!=a.statusCode&&console.log("Error statusCode="+a.statusCode);d(f,a.statusCode,b)})});e.on("error",function(a){console.log("problem with request: "+a.message)});e.end()};d.GetHttpProper=function(a,b,c,e,g,h,m,q,d){this.GetDeleteHttp("GET",
a,b,c,e,g,h,m,q,d)};d.DeleteHttp=function(a,b,c,e,g,h,m,q,d){this.GetDeleteHttp("DELETE",a,b,c,e,g,h,m,q,d)};var G=0,H=require("url");try{var B=A.resolve(l("cirruswaveutil.js"),"./lib/deploy.json"),y=r.readFileSync(B,"UTF8"),C=JSON.parse(y)}catch(a){"ENOENT"!=a.code&&console.log(a.code+" - "+a.message)}d.RestTaskCall=function(a,b,c){var e=!1,g={};a.payload&&console.log("\t\tpayload ="+JSON.stringify(a.payload));var h=null;if(a.service&&a.servicepath){if(a.sysservice){if(!a.serviceconfig){g="Parameter error: Task="+
a.name+" does not contain serviceconfig";console.error(g);b(c,404,JSON.stringify(g));return}var m=this.GetServiceConfig(a.serviceconfig,a.service)}else{if(!a.appserviceconfig){g="Parameter error: Task="+a.name+" does not contain appserviceconfig";console.error(g);b(c,404,JSON.stringify(g));return}m=this.GetServiceConfig(a.appserviceconfig,a.service);if(!m){if(!a.serviceconfig){g="Parameter error: Task="+a.name+" does not contain serviceconfig";console.error(g);b(c,404,JSON.stringify(g));return}m=
this.GetServiceConfig(a.serviceconfig,a.service)}}if(!(m&&"object"==typeof m&&m.hasOwnProperty("protocol")&&m.hasOwnProperty("hostname")&&m.hasOwnProperty("port"))){g="Parameter error: Task="+a.name+" has unrecognized service="+a.service+" sc="+JSON.stringify(m);console.error(g);b(c,404,JSON.stringify(g));return}C&&C.dnsservicename&&"localhost"==m.hostname&&(m.hostname=a.service);e=!0;g.protocol=m.protocol;g.hostname=m.hostname;g.port=m.port;switch(m.security){case "basic":case "accesskey":h={};h.security=
m.security;h.nonce=G++;h.acckey=a.acckey;h.secret=a.secretna;break;case "appkey":g.key=a.appkey?this.MakeKeyServiceAndKeyValue(a.service,a.appkey):this.MakeKeyServiceAndKeyValue(a.service,m.key)}g.pathname=a.servicepath;0!=g.pathname.search("/")&&(g.pathname="/"+g.pathname)}if(a.url||e)switch(e=null,a.payload&&(e=a.payload),a.url&&(g=H.parse(a.url),g.key=null),a.method){case "POST":a="";e&&(a=JSON.stringify(e));this.PostPutHttp("POST",h,g.key,g.protocol,g.hostname,g.pathname,g.port,a,b,c);break;case "PUT":a=
"";e&&(a=JSON.stringify(e));this.PostPutHttp("PUT",h,g.key,g.protocol,g.hostname,g.pathname,g.port,a,b,c);break;case "GET":a="";e&&(a=I(e));this.GetHttpProper(h,g.key,g.protocol,g.hostname,g.pathname,g.port,a,b,c);break;case "DELETE":a="";e&&(a=I(e));this.DeleteHttp(h,g.key,g.protocol,g.hostname,g.pathname,g.port,a,b,c);break;default:g=a.hasOwnProperty("name")?"Parameter error: Task="+a.name+" has unrecognized method="+a.method:"Parameter error: unrecognized method="+a.method,console.error(g),b(c,
404,{error:g})}else a.func?(a.payload&&JSON.parse(JSON.stringify(a.payload)),g=eval("this.to."+a.func+"(payload)"),b(c,200,g)):b(c,200,{})};d.ServiceKeyName=function(a){return a+"-api-key"};d.MakeKeyServiceAndKeyValue=function(a,b){if(!b)return null;var c={};c.keyName=this.ServiceKeyName(a);c.keyValue=b;return c};d.EstablishKey=function(a,b){var c=r.readFileSync(a,"utf8");c=JSON.parse(c);var e=c.services;if(!e||!e[b]||"appkey"!==e[b].security)return null;e[b].key||(e[b].key=this.GenerateKeyFromDate((new Date).toString()),
r.writeFileSync(a,JSON.stringify(c,0,2),"UTF8"));return e[b].key};d.GenerateKeyFromDate=function(a){return w.createHash("md5").update(a).digest("hex")};d.GetServiceConfig=function(a,b){var c=r.readFileSync(a,"utf8");c=JSON.parse(c);if(!c)return null;var e=c.services;if(!e||!e[b])return null;c=e[b];e[b].security||(e[b].security="nokey",r.writeFileSync(a,JSON.stringify(c,0,2),"UTF8"));return e[b]};d.PriorityQueue=function(a){this._comparator=a||this.DEFAULT_COMPARATOR;this._elements=[];this.DEFAULT_COMPARATOR=
function(a,c){if("number"===typeof a&&"number"===typeof c)return a-c;a=a.toString();c=c.toString();return a==c?0:a>c?1:-1};d.PriorityQueue.isEmpty=function(){return 0===this.size()};this.peek=function(){if(this.isEmpty())throw Error("PriorityQueue is empty");return this._elements[0]};this.deq=function(){return this._elements.length?this._elements.shift():null};this.enq=function(a){a=this._elements.push(a);for(var b=a-1;0<b;){var e=b-1;if(0>=this._compare(b,e))break;this._swap(e,b);b=e}return a};this.size=
function(){return this._elements.length};this.getElement=function(a){return 0>a||a>=this.size()?null:this._elements[a]};this.getElements=function(a){return this._elements};this.forEach=function(a){return this._elements.forEach(a)};this._compare=function(a,c){return this._comparator(this._elements[a],this._elements[c])};this._swap=function(a,c){var b=this._elements[a];this._elements[a]=this._elements[c];this._elements[c]=b}};var z=require("cacheman");d.TtlCache=function(a,b,c){if(!a)return null;if(b||
c){var e={};b&&(e.ttl=b);c&&(e.engine=c);this.cache=new z(a,e)}else this.cache=new z(a);this.Set=function(a,b,c){this.cache.set(a,b,c)};this.Get=function(a,b){this.cache.get(a,b)}};var D=require("dgram");d.Udp=function(a,b,c,e){this.server=D.createSocket("udp4");a||b?(this.server.bind({address:c,port:e}),this.server.on("listen",a),this.server.on("message",b),this.broadcastMode=!1):this.broadcastMode=!0;this.address=function(){return this.server.address().address};this.port=function(){return this.server.address().port};
this.broadcast=function(a,b,c){if(this.broadcastMode){var h=new Buffer(JSON.stringify(c));this.server.send(h,0,h.length,b,a,function(){console.log("Sent '"+h+"'")})}}};return n.exports};n[1]=function(n,d){function u(a,b){return{status:a,message:b}}function k(a,b){c.storage.Get(a,c.folderkeys,function(c,h){c?b(u(404,"acckey="+a+" "+c),null):b(null,h)})}function t(a,b){k(a,function(a,c){a?b(a,null):(a=JSON.parse(JSON.stringify(c)),delete a.secret,b(null,a))})}function x(a,b){c.storage.Get(a,c.folderids,
function(c,h){c?b(u(404,"client="+a+" "+c),null):b(null,h)})}function p(a,b,e){c.storage.Put(a,b,c.folderids,function(h,m){h?e(u(404,h),null):"file"===c.type?e(null,m):c.storage.Put(b.acckey,b,c.folderkeys,function(b,c){b&&A(a,!1,function(a,c){a?c(u(404,a),null):c(u(404,b),null)});e(null,c)})})}function r(a,b,c,e,d){x(a,function(h,m){var g={services:[]};h||(g=m);g.acckey=b;g.secret=c;g.clientid=a;for(var q in e)0>g.services.indexOf(e[q])&&g.services.push(e[q]);p(a,g,d)})}function A(a,b,e){x(a,function(h,
m){c.storage.Delete(a,c.folderids,function(a,h){a?e(a,null):"file"!==c.type&&b?c.storage.Delete(m.acckey,c.folderkeys,function(a,b){a?e(a,null):e(null,"OK")}):e(null,"OK")})})}function F(a,b){if(a=a.authorization)if(0!=a.search(/basic /i))b(u(403,"basic authorization header needs to start with basic"),null);else{a=a.slice(6);var c=Buffer.from(a,"base64").toString().split(":"),h=c[0];k(h,function(a,e){a?b(u(403,"acckey="+h+" not found"),null):c[1]===e.secret?b(null,e):b(u(403,"could not authenticate"),
null)})}else b(u("403","Authorization header missing"),null)}function w(a,b){var c=a.authorization;if(c)if(0!=c.search(/hmac /i))F(a,b);else{var e=c.slice(5).split(":"),h=e[0];k(h,function(c,m){if(c)b(u(403,"acckey="+h+" not found"),null);else{var g=a.date,d=e.splice(-1,1)[0];c=e.join(":");B(m.secret,c+(":"+g))==d?b(null,m):b(u(403,"could not authenticate"),null)}})}else b(u(403,"Authorization header missing"),null)}function E(a,b,c){var e=(new Date).valueOf(),h=Math.round(Math.random()*e),m=y.GenerateKeyFromDate(h.toString());
h=Math.round(Math.random()*e);e=y.GenerateKeyFromDate(h.toString());r(a,m,e,b,c)}function J(a){var b=y.GetServiceConfig(z,a);return b?b:b=y.GetServiceConfig(D,a)}function G(a,b,c){k(a,function(a,e){a?c(a,null):(a=J(b))?"accesskey"!==a.security&&"basic"!==a.security?c(u(403,"access is forbidden to service="+b),null):(b&&0>e.services.indexOf(b)&&e.services.push(b),p(e.clientid,e,c)):c(u(404,"No such service="+b),null)})}function H(a,b,c){k(a,function(a,e){a=J(b);"accesskey"!==a.security&&"basic"!==
a.security?c(u(403,"access is forbidden"),null):(a=e.services.indexOf(b),0>a?c(u(403,"no access to service="+b),null):(e.services.splice(a,1),p(e.clientid,e,c)))})}function B(a,b){a=C.createHmac("sha256",a);a.update(b);return a.digest("hex")}var y=f(0,1),C=require("crypto"),z=l("apikeymgr.js")+"/deploy/lib/serviceconfig.json",D=z,a=l("apikeymgr.js");require("fs");var b=require("path"),c=null,e=f(2,1),g=f(3,1);d.initialize=function(h){var d="./deploy/lib/aclconfig.json";if(h)switch(a=h.appdir,d=h.aclconfig,
D=b.resolve(a,h.appserviceconfig),c={type:"file"},h.persistence&&(c=h.persistence),c.folderkeys="pc-keyfolder/keys",c.folderids="pc-keyfolder/ids",c.type){case "file":c.storage=new g(h);break;case "s3":c.storage=new e({encseckey:h.secret,bucketName:c.bucketname,acckey:c.acckey,secretkey:c.secret,region:c.region})}h.aclconfpath=b.resolve(a,d)};d.Sign=function(a,b){return B(a,b)};d.RouteAllocateAccessKeys=function(a,b){E(a.params.clientid,[],function(a,c){a?b.status(a.status).json(a.message):b.status(200).json(c)})};
d.RouteGetClientFromClientid=function(a,b){x(a.params.clientid,function(a,c){a?b.status(a.status).json(a.message):b.status(200).json(c)})};d.RouteGetClientFromAcckey=function(a,b){k(a.params.acckey,function(a,c){a?b.status(a.status).json(a.message):b.status(200).json(c)})};d.RouteRevokeClient=function(a,b){A(a.params.clientid,!0,function(a,c){a?b.status(a.status).json(a.message):b.status(200).json({data:"OK"})})};d.RouteGrantAccess=function(a,b){G(a.params.acckey,a.params.servicename,function(a,c){a?
b.status(a.status).json(a.message):b.status(200).json(c)})};d.RouteRevokeAccess=function(a,b){H(a.params.acckey,a.params.servicename,function(a,c){a?b.status(a.status).json(a.message):b.status(200).json(c)})};d.RouteGetAccessServices=function(a,b){t(a.params.acckey,function(a,c){a?b.status(a.status).json(a.message):b.status(200).json(c.services)})};d.RouteGetAccessOneService=function(a,b){t(a.params.acckey,function(c,e){c?b.status(c.status).json(c.message):0>e.services.indexOf(a.params.servicename)?
b.status(404).json("access was never granted to client="+e.clientid+" for service="+servicename):b.status(200).json(a.params.servicename)})};d.RouteCheckAccessOneService=function(a,b){a.body.headers?w(a.body.headers,function(c,e){c?b.status(c.status).json(c.message):0>e.services.indexOf(a.body.servicename)?b.status(404).json("access was never granted to client="+o.clientid+" for service="+servicename):b.status(200).json({servicename:a.body.servicename})}):b.status(400).json("headers missing in the body of request")};
return n.exports};n[2]=function(k,d){var n=f(0,2),l=require("aws-sdk"),t=f(4,2);d=function(d){var f=t.call(this)||this;f.bucketName=d.bucketName;f.encseckey=d.encseckey;l.config.region=d.region;l.config.update({accessKeyId:d.acckey,secretAccessKey:d.secretkey});return f};$jscomp.inherits(d,t);d.prototype.Delete=function(d,f,r){(new l.S3({params:{Bucket:this.bucketName+"/"+f}})).deleteObject({Key:d},function(f,p){if(f)return console.log("Error in posting Content ["+f+"]"),!1;console.log("Successfully Deleted Key = "+
d);r&&r(null,"OK")}).on("httpUploadProgress",function(d){console.log(Math.round(d.loaded/d.total*100)+"% done")})};d.prototype.Get=function(d,f,r){var p=this;(new l.S3({params:{Bucket:this.bucketName+"/"+f}})).getObject({Key:d},function(d,f){if(d)return d="Error in getting Content ["+d+"]",console.log(d),r&&r(d,null),!1;d=f.Body.toString();p.encseckey&&(d=n.Decipher(p.encseckey,d),d=d.toString("UTF8"));console.log("Successfully Get Key = "+d);r&&r(null,JSON.parse(d))}).on("httpUploadProgress",function(d){console.log(Math.round(d.loaded/
d.total*100)+"% done")})};d.prototype.ListRecursive=function(d,f,r){var p=new l.S3({params:{Bucket:this.bucketName+"/"+d}});f={Bucket:this.bucketName,MaxKeys:100,ContinuationToken:f};null===d?f.Delimiter="/":f.Prefix="*"!=d?d:"";p.listObjectsV2(f,function(f,p){if(f)return strErr="Error in listing Contents ["+f+"]",console.log(strErr),r&&r(strErr,null),!1;r&&r(null,p);p.NextContinuationToken&&(console.log("continue="+p.NextContinuationToken),this.ListRecursive(d,p.NextContinuationToken))}).on("httpUploadProgress",
function(d){console.log(Math.round(d.loaded/d.total*100)+"% done")})};d.prototype.Listirectories=function(d){this.ListRecursive(null,null,d)};d.prototype.ListObjects=function(d,f){this.ListRecursive(d,null,f)};d.prototype.Put=function(d,f,r,k){r=new l.S3({params:{Bucket:this.bucketName+"/"+r}});var p=JSON.stringify(f);this.encseckey&&(p=n.Cipher(this.encseckey,p));r.putObject({Key:d,Body:p,ContentType:"text/plain; charset=utf-8"},function(d,p){if(d)return d="Error in posting Content ["+d+"]",console.log(d),
k&&k(d,null),!1;console.log("Successfully posted Content");k&&k(null,f)}).on("httpUploadProgress",function(d){console.log(Math.round(d.loaded/d.total*100)+"% done")})};k.exports=d;return k.exports};n[3]=function(k,d){var l=f(0,3),n=f(4,3),t=require("fs"),x=require("path");d=function(d){var f=n.call(this)||this;f.aclpath=d.aclconfpath;f.encseckey=d.secret;f.appdir=d.appdir;console.log(f.appdir);console.log(d.aclconfig);f.aclpath=x.resolve(f.appdir,d.aclconfig);f.acl=null;t.existsSync(f.aclpath)&&(f.acl=
f.ReadAclFromFile(f.aclpath));f.acl||(f.acl={},f.WriteAclToFile(f.aclpath));return f};$jscomp.inherits(d,n);d.prototype.CreateSignature=function(d){return crypto.createHash("sha256").update(d).digest("hex")};d.prototype.WriteAclToFile=function(d){d=JSON.stringify(this.acl);d=l.Cipher(this.encseckey,d);t.writeFileSync(this.aclpath,d)};d.prototype.ReadAclFromFile=function(d){d=t.readFileSync(this.aclpath,"utf8");d=l.Decipher(this.encseckey,d);if(!d)return null;d=d.toString("UTF8");return JSON.parse(d)};
d.prototype.Delete=function(d,f,k){var p=-1;if("pc-keyfolder/keys"===f){for(var l in this.acl)this.acl[l].acckey==d&&(p=l);if(-1===p){k("key "+d+" not found",null);return}}else p=d;delete this.acl[p];k&&k(null,"OK")};d.prototype.Listirectories=function(){};d.prototype.ListObjects=function(d){};d.prototype.Get=function(d,f,k){if("pc-keyfolder/keys"===f){for(var l in this.acl){var n=this.acl[l];if(n.acckey==d){n.clientid=l;k(null,n);return}}console.log("name="+d+" folder="+f);k("key "+d+" not found",
null)}else this.acl[d]?(this.acl[d].clientid=d,k(null,this.acl[d])):(console.log("name="+d+" folder="+f),k("client "+d+" does not exist",null))};d.prototype.Put=function(d,f,k,l){this.acl[d]||(this.acl[d]={services:[]});this.acl[d].acckey=f.acckey;this.acl[d].secret=f.secret;for(var n in f.services)0>this.acl[d].services.indexOf(f.services[n])&&this.acl[d].services.push(f.services[n]);this.WriteAclToFile(this.aclpath);l(null,this.acl[d])};k.exports=d;return k.exports};n[4]=function(f,d){f.exports=
function(){"storagedriver"===this.constructor.name&&(console.error("can not instantiate storage driver"),process.exit(1));var d=[];void 0===this.Get&&d.push("Get");void 0===this.Delete&&d.push("Delete");void 0===this.Listirectories&&d.push("Listirectories");void 0===this.ListObjects&&d.push("ListObjects");void 0===this.Put&&d.push("Put");d.length&&(console.error(d+" required on "+this.constructor.name+" class"),process.exit(1))};return f.exports};if("object"===typeof module)module.exports=f(0);else return f(0)})();
